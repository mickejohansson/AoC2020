import day20, { Tile, Side } from './day20'

test('it parses tiles', () => {
  const testTile: Tile = {
    id: 2311,
    data: [
      ['.', '.', '#', '#', '.', '#', '.', '.', '#', '.'],
      ['#', '#', '.', '.', '#', '.', '.', '.', '.', '.'],
      ['#', '.', '.', '.', '#', '#', '.', '.', '#', '.'],
      ['#', '#', '#', '#', '.', '#', '.', '.', '.', '#'],
      ['#', '#', '.', '#', '#', '.', '#', '#', '#', '.'],
      ['#', '#', '.', '.', '.', '#', '.', '#', '#', '#'],
      ['.', '#', '.', '#', '.', '#', '.', '.', '#', '#'],
      ['.', '.', '#', '.', '.', '.', '.', '#', '.', '.'],
      ['#', '#', '#', '.', '.', '.', '#', '.', '#', '.'],
      ['.', '.', '#', '#', '#', '.', '.', '#', '#', '#']
    ]
  }

  const tiles = day20.parseTiles(__dirname + '/testInput.txt')
  expect(tiles[0]).toMatchObject(testTile)
})

test('it rotates a tile', () => {
  const beforeRotation: Tile = {
    id: 2311,
    data: [
      ['.', '.', '#', '#', '.', '#', '.', '.', '#', '.'],
      ['#', '#', '.', '.', '#', '.', '.', '.', '.', '.'],
      ['#', '.', '.', '.', '#', '#', '.', '.', '#', '.'],
      ['#', '#', '#', '#', '.', '#', '.', '.', '.', '#'],
      ['#', '#', '.', '#', '#', '.', '#', '#', '#', '.'],
      ['#', '#', '.', '.', '.', '#', '.', '#', '#', '#'],
      ['.', '#', '.', '#', '.', '#', '.', '.', '#', '#'],
      ['.', '.', '#', '.', '.', '.', '.', '#', '.', '.'],
      ['#', '#', '#', '.', '.', '.', '#', '.', '#', '.'],
      ['.', '.', '#', '#', '#', '.', '.', '#', '#', '#']
    ]
  }
  const afterRotation: Tile = {
    id: 2311,
    data: [
      ['.', '#', '.', '.', '#', '#', '#', '#', '#', '.'],
      ['.', '#', '.', '#', '#', '#', '#', '.', '#', '.'],
      ['#', '#', '#', '.', '.', '.', '#', '.', '.', '#'],
      ['#', '.', '.', '#', '.', '#', '#', '.', '.', '#'],
      ['#', '.', '.', '.', '.', '#', '.', '#', '#', '.'],
      ['.', '.', '.', '#', '#', '.', '#', '#', '.', '#'],
      ['.', '#', '.', '.', '.', '#', '.', '.', '.', '.'],
      ['#', '.', '#', '.', '#', '#', '.', '.', '.', '.'],
      ['#', '#', '.', '#', '#', '#', '.', '#', '.', '#'],
      ['#', '.', '.', '#', '#', '.', '#', '.', '.', '.']
    ]
  }
  const tiles = day20.parseTiles(__dirname + '/testInput.txt')
  const rotatedTile = day20.rotateCW(tiles[0])
  expect(rotatedTile).toMatchObject(afterRotation)
  expect(tiles[0]).toMatchObject(beforeRotation)
})

test('it flips a tile', () => {
  const beforeFlip: Tile = {
    id: 2311,
    data: [
      ['.', '.', '#', '#', '.', '#', '.', '.', '#', '.'],
      ['#', '#', '.', '.', '#', '.', '.', '.', '.', '.'],
      ['#', '.', '.', '.', '#', '#', '.', '.', '#', '.'],
      ['#', '#', '#', '#', '.', '#', '.', '.', '.', '#'],
      ['#', '#', '.', '#', '#', '.', '#', '#', '#', '.'],
      ['#', '#', '.', '.', '.', '#', '.', '#', '#', '#'],
      ['.', '#', '.', '#', '.', '#', '.', '.', '#', '#'],
      ['.', '.', '#', '.', '.', '.', '.', '#', '.', '.'],
      ['#', '#', '#', '.', '.', '.', '#', '.', '#', '.'],
      ['.', '.', '#', '#', '#', '.', '.', '#', '#', '#']
    ]
  }
  const afterFlip: Tile = {
    id: 2311,
    data: [
      ['.', '#', '.', '.', '#', '.', '#', '#', '.', '.'],
      ['.', '.', '.', '.', '.', '#', '.', '.', '#', '#'],
      ['.', '#', '.', '.', '#', '#', '.', '.', '.', '#'],
      ['#', '.', '.', '.', '#', '.', '#', '#', '#', '#'],
      ['.', '#', '#', '#', '.', '#', '#', '.', '#', '#'],
      ['#', '#', '#', '.', '#', '.', '.', '.', '#', '#'],
      ['#', '#', '.', '.', '#', '.', '#', '.', '#', '.'],
      ['.', '.', '#', '.', '.', '.', '.', '#', '.', '.'],
      ['.', '#', '.', '#', '.', '.', '.', '#', '#', '#'],
      ['#', '#', '#', '.', '.', '#', '#', '#', '.', '.']
    ]
  }
  const tiles = day20.parseTiles(__dirname + '/testInput.txt')
  expect(tiles[0]).toMatchObject(beforeFlip)
  const flippedTile = day20.flipHorizontal(tiles[0])
  expect(flippedTile).toMatchObject(afterFlip)
  expect(tiles[0]).toMatchObject(beforeFlip)
})


test('it gets the borders of a tile', () => {
  const testTile: Tile = {
    id: 2311,
    data: [
      ['.', '.', '#', '#', '.', '#', '.', '.', '#', '.'],
      ['#', '#', '.', '.', '#', '.', '.', '.', '.', '.'],
      ['#', '.', '.', '.', '#', '#', '.', '.', '#', '.'],
      ['#', '#', '#', '#', '.', '#', '.', '.', '.', '#'],
      ['#', '#', '.', '#', '#', '.', '#', '#', '#', '.'],
      ['#', '#', '.', '.', '.', '#', '.', '#', '#', '#'],
      ['.', '#', '.', '#', '.', '#', '.', '.', '#', '#'],
      ['.', '.', '#', '.', '.', '.', '.', '#', '.', '.'],
      ['#', '#', '#', '.', '.', '.', '#', '.', '#', '.'],
      ['.', '.', '#', '#', '#', '.', '.', '#', '#', '#']
    ]
  }
  const tiles = day20.parseTiles(__dirname + '/testInput.txt')
  expect(tiles[0]).toMatchObject(testTile)
  expect(day20.getBorders(tiles[0])).toMatchObject([210, 89, 231, 498])
})

test('it calculates the product of the corner ids', () => {
  expect(day20.cornerProduct(__dirname + '/testInput.txt')).toBe(20899048083289)
  expect(day20.cornerProduct(__dirname + '/input.txt')).toBe(28057939502729)
})

test('it builds a map', () => {
  let map = day20.buildMap(__dirname + '/testInput.txt')
  expect(map.length).toBe(3)
  map = day20.buildMap(__dirname + '/input.txt')
  expect(map.length).toBe(12)
})

/*
test('it rotates a tile', () => {
  const testTile: Tile = {
    borders: [210, 89, 924, 318],
    data: [
      ['.', '.', '#', '#', '.', '#', '.', '.', '#', '.'],
      ['#', '#', '.', '.', '#', '.', '.', '.', '.', '.'],
      ['#', '.', '.', '.', '#', '#', '.', '.', '#', '.'],
      ['#', '#', '#', '#', '.', '#', '.', '.', '.', '#'],
      ['#', '#', '.', '#', '#', '.', '#', '#', '#', '.'],
      ['#', '#', '.', '.', '.', '#', '.', '#', '#', '#'],
      ['.', '#', '.', '#', '.', '#', '.', '.', '#', '#'],
      ['.', '.', '#', '.', '.', '.', '.', '#', '.', '.'],
      ['#', '#', '#', '.', '.', '.', '#', '.', '#', '.'],
      ['.', '.', '#', '#', '#', '.', '.', '#', '#', '#']
    ],
    id: 2311
  }
  day20.rotateCW(testTile)
  expect(testTile.borders).toMatchObject([318, 210, 89, 924])
})

test('it flips a tile', () => {
  const testTile: Tile = {
    borders: [210, 89, 924, 318],
    data: [
      ['.', '.', '#', '#', '.', '#', '.', '.', '#', '.'],
      ['#', '#', '.', '.', '#', '.', '.', '.', '.', '.'],
      ['#', '.', '.', '.', '#', '#', '.', '.', '#', '.'],
      ['#', '#', '#', '#', '.', '#', '.', '.', '.', '#'],
      ['#', '#', '.', '#', '#', '.', '#', '#', '#', '.'],
      ['#', '#', '.', '.', '.', '#', '.', '#', '#', '#'],
      ['.', '#', '.', '#', '.', '#', '.', '.', '#', '#'],
      ['.', '.', '#', '.', '.', '.', '.', '#', '.', '.'],
      ['#', '#', '#', '.', '.', '.', '#', '.', '#', '.'],
      ['.', '.', '#', '#', '#', '.', '.', '#', '#', '#']
    ],
    id: 2311
  }
  day20.flip(testTile)
  expect(testTile.borders).toMatchObject([300, 498, 231, 616])
})

test('it finds a matching tile', () => {
  const testTile: Tile = {
    borders: [210, 89, 924, 318],
    data: [
      ['.', '.', '#', '#', '.', '#', '.', '.', '#', '.'],
      ['#', '#', '.', '.', '#', '.', '.', '.', '.', '.'],
      ['#', '.', '.', '.', '#', '#', '.', '.', '#', '.'],
      ['#', '#', '#', '#', '.', '#', '.', '.', '.', '#'],
      ['#', '#', '.', '#', '#', '.', '#', '#', '#', '.'],
      ['#', '#', '.', '.', '.', '#', '.', '#', '#', '#'],
      ['.', '#', '.', '#', '.', '#', '.', '.', '#', '#'],
      ['.', '.', '#', '.', '.', '.', '.', '#', '.', '.'],
      ['#', '#', '#', '.', '.', '.', '#', '.', '#', '.'],
      ['.', '.', '#', '#', '#', '.', '.', '#', '#', '#']
    ],
    id: 2311
  }
  const matchingTestTile: Tile = {
    borders: [146, 498, 404, 302],
    data: [
      ['.', '.', '#', '.', '.', '#', '.', '.', '#', '.'],
      ['#', '#', '.', '.', '#', '.', '.', '.', '.', '#'],
      ['#', '.', '.', '.', '#', '#', '.', '.', '#', '#'],
      ['#', '#', '#', '#', '.', '#', '.', '.', '.', '#'],
      ['.', '#', '.', '#', '#', '.', '#', '#', '#', '#'],
      ['#', '#', '.', '.', '.', '#', '.', '#', '#', '#'],
      ['.', '#', '.', '#', '.', '#', '.', '.', '#', '.'],
      ['.', '.', '#', '.', '.', '.', '.', '#', '.', '.'],
      ['#', '#', '#', '.', '.', '.', '#', '.', '#', '#'],
      ['.', '.', '#', '.', '#', '.', '.', '#', '#', '.']
    ],
    id: 3333
  }
  expect(
    day20.findMatchingTile(testTile, Side.LEFT, [matchingTestTile]).id
  ).toBe(3333)
})

test('it arranges the tiles and calculates the product of the corner ids', () => {
  expect(day20.cornerProduct(__dirname + '/testInput.txt')).toBe(20899048083289)
  expect(day20.cornerProduct(__dirname + '/input.txt')).toBe(28057939502729)
})

test('it builds the map', () => {
  expect(day20.buildMap(__dirname + '/testInput.txt').length).toBe(3)
})
*/
